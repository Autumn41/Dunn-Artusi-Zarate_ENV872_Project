---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Assessing water level changes from hurricanes from 2000 - 2020"
subtitle: "https://github.com/Autumn41/Dunn-Artusi-Zarate_ENV872_Project.git"
author: "Camila Zarate Ospina, Savannah Artusi, and Autumn Dunn"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

Set-Up Work Space
```{r setup, include=FALSE}
# Load packages
if(!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, lubridate, ggpubr, dplyr, zoo, dataRetrieval)

# Set ggplot theme
mytheme <- theme_grey() +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right")
theme_set(mytheme)
```

Input Raw Data
```{r DataRaw}
# Select Site
siteNo1 <-"02137727"
siteNo2 <-"02111000"
siteNo3 <-"03446000"
siteNo4 <-"03447687"

# Identify parameter of interest: 
pcode = '00065' #gage height (feet)

# Identify statistic code for daily values: 
scode = "00003"  #mean

# Identify start and end dates
start.date = "2000-01-01"
end.date = "2020-12-01"

# Load in data using the package's "readNWISdv" function
Catawba <- readNWISdv(siteNumbers = siteNo1, 
                    parameterCd = pcode, 
                    statCd = scode, 
                    startDate=start.date, 
                    endDate=end.date)

Yadkin <- readNWISdv(siteNumbers = siteNo2, 
                    parameterCd = pcode, 
                    statCd = scode, 
                    startDate=start.date, 
                    endDate=end.date)

Mills <- readNWISdv(siteNumbers = siteNo3, 
                    parameterCd = pcode, 
                    statCd = scode, 
                    startDate=start.date, 
                    endDate=end.date)

FrenchBroad <- readNWISdv(siteNumbers = siteNo4, 
                    parameterCd = pcode, 
                    statCd = scode, 
                    startDate=start.date, 
                    endDate=end.date)

# Rename columns
Catawba <- renameNWISColumns(Catawba); 
colnames(Catawba)
saveRDS(Catawba, file ="../Data/Raw/Catawba.rds")

Yadkin <- renameNWISColumns(Yadkin); 
colnames(Yadkin)
saveRDS(Yadkin, file ="../Data/Raw/Yadkin.rds")

Mills <- renameNWISColumns(Mills); 
colnames(Mills)
saveRDS(Mills, file ="../Data/Raw/Mills.rds")

FrenchBroad <- renameNWISColumns(FrenchBroad); 
saveRDS(FrenchBroad, file ="../Data/Raw/FrenchBroad.rds")
```

Process Data
```{r DataProcessing}
#Catawba
Catawba$Date<-as.Date(Catawba$Date, format = "%Y/%m/%d")
Catawba_sept <- Catawba %>% 
                  select(Date, GH) %>% 
                  mutate(Month = month(Date),
                         Year = year(Date)) %>% 
                  filter(Month %in% ("9")) %>% 
                  select(Date, GH, Year)
saveRDS(Catawba_sept, file ="../Data/Processed/Catawba_sept.rds")

#Yadkin
Yadkin$Date<-as.Date(Yadkin$Date, format = "%Y/%m/%d")
Yadkin_sept <- Yadkin %>% 
                  select(Date, GH) %>% 
                  mutate(Month = month(Date),
                         Year = year(Date)) %>% 
                  filter(Month %in% ("9")) %>% 
                  select(Date, GH, Year)
saveRDS(Yadkin_sept, file ="../Data/Processed/Yadkin_sept.rds")

#Mills
Mills$Date<-as.Date(Mills$Date, format = "%Y/%m/%d")
Mills_sept <- Mills %>% 
                  select(Date, GH) %>% 
                  mutate(Month = month(Date),
                         Year = year(Date)) %>% 
                  filter(Month %in% ("9")) %>% 
                  select(Date, GH, Year)
saveRDS(Mills_sept, file ="../Data/Processed/Mills_sept.rds")

#FrenchBroad
FrenchBroad$Date<-as.Date(FrenchBroad$Date, format = "%Y/%m/%d")
FrenchBroad_sept <- FrenchBroad %>% 
                  select(Date, GH) %>% 
                  mutate(Month = month(Date),
                         Year = year(Date)) %>% 
                  filter(Month %in% ("9")) %>% 
                  select(Date, GH, Year)
saveRDS(FrenchBroad_sept, file ="../Data/Processed/FrenchBroad_sept.rds")
```

# Rationale and Research Questions

From 2000 to 2020, North Carolina was hit with 64 hurricanes and 26 of those hurricanes occurred in September. With climate change, hurricanes are expected to occur more frequently and at higher intensity (Elsner, 2006). Higher intensity storms will likely cause flooding of cities and urban areas which many infrastructures are not designed to accommodate (James et al., 2020; Marsooli & Lin, 2020). Additionally, much of North Carolina Piedmont wetlands have been drained and many streams are degraded due to urban disturbances(Carle, 2011; Violin et al., 2011). Wetlands and streams are natural systems that store flood water, and without them, many areas that have not flooded in the past will be at risk (Ameli & Creed, 2019). Investing in pre-disaster hazard mitigation has been shown to be economically beneficial and save lives (Villa, 2020). In order to update infrastructure, expected water input and time period of elevated water levels are needed. Using stream gage height, we selected Catawba River, Yadkin River, Mills River, and French Broad River, because of their location along hurricane paths. We focused on two questions: has gage height changed over 2000-2020 for September from hurricanes and how much does a stream gage height change after a hurricane?

\newpage

# Dataset Information

Taken from USGS National Water Information. USGS uses an eight digit code for each site (listed below). The parameter of interest, represented as GH in the tables, was gage height (feet), identified using the pcode 00065. Daily mean value was used, using the scode 00003.

Site locations and site codes:
 Catawba River  (Pleasant Gardens) - 02137727
 Yadkin River (Patterson) - 02111000
 Mills River (Mills River) - 03446000
 French Broad River (Fletcher) - 03447687


\newpage

# Exploratory Analysis 
```{r Plots}
#Plot 1 - Catawba Gage Height as points on individual plots for September
ggplot(Catawba_sept, aes(y=GH, x=Date)) +
  geom_point() +
  xlab("Date") +
  ylab("Gage Height (feet)") +
  mytheme +
  facet_wrap(vars(Year)) 

#Plot 2 - Yadkin Gage Height as points on individual plots for September
ggplot(Yadkin_sept, aes(y=GH, x=Date)) +
  geom_point() +
  xlab("Date") +
  ylab("Gage Height (feet)") +
  mytheme +
  facet_wrap(vars(Year)) 

#Plot 3 - Mills Gage Height as points on individual plots for September
ggplot(Mills_sept, aes(y=GH, x=Date)) +
  geom_point() +
  xlab("Date") +
  ylab("Gage Height (feet)") +
  mytheme +
  facet_wrap(vars(Year)) 

#Plot 4 - FrenchBroad Gage Height as points on individual plots for September
ggplot(FrenchBroad_sept, aes(y=GH, x=Date)) +
  geom_point() +
  xlab("Date") +
  ylab("Gage Height (feet)") +
  mytheme +
  facet_wrap(vars(Year)) 
```



\newpage

# Analysis

Time Series of four rivers from 2000 - 2020
```{r TimeSeries}

## Catawba ##

# Generate time series
Start_month <- month(first(Catawba_sept))
Start_year <- year(first(Catawba_sept))

Catawba.daily.ts <- ts(Catawba$GH,
                   start=c(Start_year,Start_month),
                   frequency=30) 

# Decompose
Day_Catawba_decomp <- stl(Catawba.daily.ts, s.window = "periodic")
plot(Day_Catawba_decomp)

# Run SMK test
Month_Catawba_trend <- Kendall::SeasonalMannKendall(Catawba.daily.ts)

# Inspect results
summary(Month_Catawba_trend)


## Yadkin ##

# Generate time series
Start_month2 <- month(first(Yadkin_sept))
Start_year2 <- year(first(Yadkin_sept))

Yadkin.daily.ts <- ts(Yadkin$GH,
                   start=c(Start_year2,Start_month2),
                   frequency=30) 

# Decompose
Day_Yadkin_decomp <- stl(Yadkin.daily.ts, s.window = "periodic")
plot(Day_Yadkin_decomp)

# Run SMK test
Month_Yadkin_trend <- Kendall::SeasonalMannKendall(Yadkin.daily.ts)

# Inspect results
summary(Month_Yadkin_trend)


## Mills ##

# Generate time series
Start_month3 <- month(first(Mills_sept))
Start_year3 <- year(first(Mills_sept))

Mills.daily.ts <- ts(Yadkin$GH,
                   start=c(Start_year3,Start_month3),
                   frequency=30) 

# Decompose
Day_Mills_decomp <- stl(Mills.daily.ts, s.window = "periodic")
plot(Day_Mills_decomp)

# Run SMK test
Month_Mills_trend <- Kendall::SeasonalMannKendall(Mills.daily.ts)

# Inspect results
summary(Month_Mills_trend)


## FrenchBroad ##

# Generate time series
Start_month4 <- month(first(FrenchBroad_sept))
Start_year4<- year(first(FrenchBroad_sept))

FrenchBroad.daily.ts <- ts(FrenchBroad$GH,
                   start=c(Start_year4,Start_month4),
                   frequency=30) 

# Decompose
Day_FrenchBroad_decomp <- stl(FrenchBroad.daily.ts, s.window = "periodic")
plot(Day_FrenchBroad_decomp)

# Run SMK test
Month_FrenchBroad_trend <- Kendall::SeasonalMannKendall(FrenchBroad.daily.ts)

# Inspect results
summary(Month_FrenchBroad_trend)

```

GLM model comparing Septembers from 2000 - 2020
```{r GLM}
#H0: Gage Height is the same in September every year
#Ha: Gage Height is not the same in September every year

# Catawba - GLM
Catawba_GLM <- lm(Catawba_sept$GH ~ Catawba_sept$Year)
summary(Catawba_GLM)
plot(Catawba_GLM)

# Yadkin - GLM
Yadkin_GLM <- lm(Yadkin_sept$GH ~ Yadkin_sept$Year)
summary(Yadkin_GLM)
plot(Yadkin_GLM)

# Mills - GLM
Mills_GLM <- lm(Mills_sept$GH ~ Mills_sept$Year)
summary(Mills_GLM)
plot(Mills_GLM)

# FrenchBroad - GLM
FrenchBroad_GLM <- lm(FrenchBroad_sept$GH ~ FrenchBroad_sept$Year)
summary(FrenchBroad_GLM)
plot(FrenchBroad_GLM)

```



## Question 1: Has gage height changed over 2000-2020 for September from hurricanes? 
Catawba River, Yadkin River, Mills River, and French Broad River had a significant (p-value < 0.05) monotonic upward trend. Catawba River had the largest upward trend (0.206) and Yadkin River and Mills River had the smallest upward trend (0.0218).

## Question 2: How much does a stream gage height change after a hurricane? 
Catawba River
Yadkin River
Mills River
French Broad River

\newpage

# Summary and Conclusions


\newpage

# References
Ameli, A. A., & Creed, I. F. (2019). Does Wetland Location Matter When Managing Wetlands for Watershed-Scale Flood and Drought Resilience? Journal of the American Water Resources Association, 55(3), 529–542. https://doi.org/10.1111/1752-1688.12737

Carle, M. V. (2011). Estimating wetland losses and gains in coastal north carolina: 1994-2001. Wetlands, 31(6), 1275–1285. https://doi.org/10.1007/s13157-011-0242-z

Elsner, J. B. (2006). Evidence in support of the climate change-Atlantic hurricane hypothesis. Geophysical Research Letters, 33(16), 1–3. https://doi.org/10.1029/2006GL026869

James M. Shultz, Ph.D., Duane E. Sands, M.D., James P. Kossin, Ph.D., and Sandro Galea, M.D., Dr. P. H. (2020). Double Environmental Injustice - Climate Change, Hurricane Dorian, and the Bahamas. The New England Journal of Medicine, 1–3.

Marsooli, R., & Lin, N. (2020). Impacts of climate change on hurricane flood hazards in Jamaica Bay, New York. Climatic Change, 163(4), 2153–2171. https://doi.org/10.1007/s10584-020-02932-x

Villa, Clifford, et al. Environmental Justice: Law, Policy & Regulation. Carolina Academic Press, 2020. 

Violin, C. R., Cada, P., Sudduth, E. B., Hassett, B. A., Penrose, D. L., & Bernhardt, E. S. (2011). Effects of urbanization and urban stream restoration on the physical and biological structure of stream ecosystems. Ecological Applications, 21(6), 1932–1949. https://doi.org/10.1890/10-1551.1

